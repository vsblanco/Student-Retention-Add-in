import{r as c,j as e,L as S,y as h}from"./index-UiuKNjc0.js";const y=[{name:"Angel Baez",role:"Dean of Academic Affairs",photo:"https://i.natgeofe.com/n/34b9d763-a5ef-434b-8d13-48f4919ca078/green-iguana_thumb_16x9.jpg?w=1200"},{name:"Angel Coronel",role:"Associate Dean of Academic Affairs",photo:"https://play-lh.googleusercontent.com/RHT25lYamggGxosSgW5hUxphFluO4byH-1ZbOuW7nD1AK7QfuqS6ZK_fIoDdb8UIHw"},{name:"Darlen Gutierrez",role:"Student Services Coordinator",photo:"https://i.pinimg.com/736x/28/5e/5e/285e5e923048938dbe93d20d054c0c17.jpg"},{name:"Victor Blanco",role:"Student Services Coordinator",photo:"https://wallpapers.com/images/featured/dolphin-w2b1iptrwaumv8de.jpg"},{name:"Kelvin Saliers",role:"Full Time Instructor",photo:"https://ftccollege.edu/wp-content/uploads/2023/08/mobile_programas_Construction_HVAC_R.jpg"},{name:"Yasser Rojas",role:"Full Time Instructor",photo:"https://assets.streamlinehq.com/image/private/w_512,h_512,ar_1/f_auto/v1/icons/freebies-freemojis/travel-places/travel-places/hospital-4e1hno0dnb9ndwe5yi08v.png?_a=DATAg1AAZAA0"}];function v({onSelect:s,defaultUser:i=null}){const[o,l]=c.useState(i);c.useEffect(()=>{o&&typeof s=="function"&&s(o)},[o,s]);const d=t=>t.split(" ").map(m=>m[0]||"").slice(0,2).join("").toUpperCase();return e.jsxs("div",{className:"relative p-0 flex-1 min-w-0 w-full shadow-xl rounded-lg bg-white overflow-hidden",children:[e.jsx("div",{className:"px-6 py-5 bg-gradient-to-r from-sky-500 via-indigo-500 to-violet-600 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-white/20 backdrop-blur-sm",children:e.jsxs("svg",{className:"w-5 h-5 text-white",viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:[e.jsx("path",{d:"M12 12c2.761 0 5-2.239 5-5s-2.239-5-5-5-5 2.239-5 5 2.239 5 5 5z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M21 21c0-2.761-4.03-5-9-5s-9 2.239-9 5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white text-lg font-semibold leading-tight",children:"Select User"}),e.jsx("p",{className:"text-white/85 text-xs mt-0.5",children:"Choose an account to comment as"})]})]})}),e.jsx("div",{className:"p-5",children:e.jsx("div",{id:"user-buttons-container",className:"space-y-3",role:"list",children:y.map((t,m)=>e.jsxs("button",{type:"button",role:"listitem","aria-pressed":o===t.name,className:"relative group overflow-hidden flex items-center gap-3 w-full text-left px-4 py-3 rounded-md transition-shadow duration-200 "+(o===t.name?"bg-blue-50 shadow-sm ring-1 ring-blue-200":"bg-white hover:shadow-lg"),style:{"--delay":`${m*80}ms`},onClick:()=>l(t.name),children:[e.jsx("div",{className:`flex-none w-10 h-10 rounded-full flex items-center justify-center font-semibold text-sm text-white overflow-hidden ${t.photo&&o===t.name?"ring-2 ring-offset-1 ring-blue-400":""}`,style:{background:t.photo?void 0:o===t.name?"linear-gradient(135deg,#2563eb,#7c3aed)":"#e5e7eb"},children:t.photo?e.jsx("img",{src:t.photo,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("span",{style:{color:o===t.name?"#fff":"#374151"},children:d(t.name)})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500",children:t.role})]}),e.jsx("div",{className:"flex-none w-6 h-6",children:o===t.name?e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:e.jsx("path",{d:"M20 6L9 17l-5-5",stroke:"#2563eb",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round"})}):null}),e.jsx("span",{"aria-hidden":!0,className:"absolute inset-0 rounded-md bg-black opacity-0 transition-opacity duration-200 group-hover:opacity-10 pointer-events-none"})]},t.name))})}),e.jsx("style",{children:`
				#user-buttons-container > button {
					opacity: 0;
					transform: translateY(8px);
					animation: fadeInUp 420ms cubic-bezier(.2,.9,.3,1) both;
					animation-delay: var(--delay, 0ms);
				}
				@keyframes fadeInUp {
					from { opacity: 0; transform: translateY(8px); }
					to   { opacity: 1; transform: translateY(0); }
				}
				/* small responsive tweak */
				@media (max-width: 420px) {
					:root { --container-w: 100%; }
				}
			`})]})}const k={SSO_TIMEOUT:1e4};function O(){return!(typeof Office>"u"||!Office.auth||!Office.auth.getAccessToken)}function A(){return O()}function w(s){try{const o=s.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),l=decodeURIComponent(atob(o).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join("")),d=JSON.parse(l);return d.name||d.preferred_username||"Unknown User"}catch(i){return console.error("Failed to decode JWT:",i),null}}function N(){const[s,i]=c.useState(null),[o,l]=c.useState(null),[d,t]=c.useState(!1);async function m(g={}){const{silent:p=!1,timeout:x=k.SSO_TIMEOUT}=g;t(!0);try{if(!window.Office||!Office.auth||!Office.auth.getAccessToken)throw new Error("Office SSO API is not available");const r=new Promise((b,n)=>setTimeout(()=>n(new Error("SSO timeout")),x)),f=await Promise.race([Office.auth.getAccessToken({allowSignInPrompt:!p,allowConsentPrompt:!p,forMSGraphAccess:!0}),r]);return i(f),l(null),t(!1),f}catch(r){const f=r.code?`Error ${r.code}: ${r.message}`:r.message;return console.error("SSO Error:",f),l(f),i(null),t(!1),null}}return{token:s,error:o,isLoading:d,getAccessToken:m}}const j="SSO_USER",C="SSO_MODE";function _({onNameSelect:s}){const{getAccessToken:i,error:o,isLoading:l}=N(),[d,t]=c.useState("auto"),[m,g]=c.useState(!1),[p,x]=c.useState(!1);c.useEffect(()=>{if(p)return;(async()=>{if(x(!0),!A()){console.log("SSO: Force fallback mode enabled or SSO not configured"),t("fallback");return}{console.log("SSO: Auto-attempting silent SSO...");try{const a=await i({silent:!0});if(a){const u=w(a);if(u){console.log("SSO: Silent SSO succeeded"),r(u,"sso"),h.success(`Welcome back, ${u}!`,{position:"bottom-center"}),s&&s(u),t("sso");return}}}catch{console.log("SSO: Silent SSO failed, falling back to user selection")}t("fallback"),g(!0)}})()},[p]);const r=(n,a)=>{try{typeof window<"u"&&window.localStorage&&(localStorage.setItem(j,n),localStorage.setItem(C,a))}catch(u){console.warn("Failed to cache user to localStorage",u)}},f=async()=>{console.log("SSO: Manual SSO login triggered");const n=await i({silent:!1});if(n){const a=w(n);a?(r(a,"sso"),h.success(`Success! Logged in as: ${a}`,{position:"bottom-center"}),s&&s(a),t("sso")):h.error("Failed to decode user information from token",{position:"bottom-center"})}else h.error(`SSO login failed${o?`: ${o}`:""}`,{position:"bottom-center"}),m||(g(!0),h.info("Switching to fallback login method...",{position:"bottom-center"}),setTimeout(()=>t("fallback"),1500))},b=n=>{r(n,"fallback"),h.success(`Welcome back, ${n}`,{position:"bottom-center"}),s&&s(n)};if(d==="fallback"){const n=typeof window<"u"&&window.localStorage?localStorage.getItem(j):null;return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:[e.jsx(v,{onSelect:b,defaultUser:n}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 underline",onClick:()=>t("sso"),children:"Try Microsoft SSO instead"})}),e.jsx(S,{})]})}return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Welcome!"}),e.jsx("p",{className:"text-lg text-gray-600",children:"Please sign in to get started."})]}),e.jsxs("div",{className:"flex flex-col items-center mb-4 space-y-2 w-64",children:[e.jsx("button",{className:"w-full px-4 py-2 bg-gray-800 text-white rounded hover:bg-gray-900 transition flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:f,disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white"}),e.jsx("span",{children:"Signing in..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"1",y:"1",width:"8",height:"8",fill:"#F25022"}),e.jsx("rect",{x:"11",y:"1",width:"8",height:"8",fill:"#7FBA00"}),e.jsx("rect",{x:"1",y:"11",width:"8",height:"8",fill:"#00A4EF"}),e.jsx("rect",{x:"11",y:"11",width:"8",height:"8",fill:"#FFB900"})]}),e.jsx("span",{children:"Sign in with Microsoft"})]})}),m&&e.jsx("button",{className:"w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition font-medium",onClick:()=>t("fallback"),children:"Use Demo Accounts"})]}),o&&e.jsxs("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-700 text-sm max-w-md",children:[e.jsx("p",{className:"font-semibold",children:"Authentication Error"}),e.jsx("p",{className:"mt-1",children:o})]}),e.jsx(S,{})]})}export{_ as default,N as useOfficeSSO};
